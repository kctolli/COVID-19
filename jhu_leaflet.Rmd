---
title: "JHU Leaflets"
---

```{r setup, include=FALSE}
package::libraries()

wdset("D:/COVID-project/")

states <- states()
county <- county()
ny_county <- county() %>% newyork()

pop <- my_read("./read-data/USA/population_2018.csv") %>% 
  rename(state = State) %>% rename(pop = Population)

us_state <- my_read("./read-data/JHU/JHU_us_state.csv") 

state_us <- left_join(left_join(us_state, pop), states, by = ("state_name" = "state"))
```

```{r wrangling}
pal <- colorNumeric("viridis", NULL)

us_cases <- state_us %>% 
  filter_yesterday() %>%
  select(state, cases, pop, geometry) %>% 
  group_by(state) %>% 
  mutate(percent = as.numeric((cases/pop)*100)) %>% 
  select(-cases, -pop)

us_deaths <- state_us %>% 
  filter_yesterday() %>%
  select(state, deaths, pop, geometry) %>% 
  group_by(state) %>% 
  mutate(percent = as.numeric((deaths/pop)*100)) %>% 
  select(-deaths, -pop)
```

```{r leaflet}
leaflet() %>% addTiles() %>% 
  addPolygons(data = us_cases, fillColor = ~pal(percent), group = "cases") %>%
  addPolygons(data = us_deaths, fillColor = ~pal(percent), group = "deaths") %>%
  addLayersControl(overlayGroups = c("cases", "deaths"), options = layersControlOptions(collapsed = FALSE))
```

<br /><br />

```{r update}
update()
```